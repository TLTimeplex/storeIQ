import t from"../../dist/index.mjs";let inputRuns=document.getElementById("inputRuns"),btnSetRunsInf=document.getElementById("btnSetRunsInf"),inputAmount=document.getElementById("inputAmount"),btnStartStop=document.getElementById("btnStartStop"),enableRawData=document.getElementById("enableRawData"),rawData=document.getElementById("rawData"),rawDataTable=document.getElementById("rawDataTable"),countRun=document.getElementById("countRun"),resultAvgStoreIQ=document.getElementById("resultStorageIQ"),resultAvgWebStorage=document.getElementById("resultWebstorage"),resultAvgIndexedDB=document.getElementById("resultIndexDB");btnSetRunsInf?.addEventListener("click",()=>{btnSetRunsInf.classList.contains("disabled")?(btnSetRunsInf.classList.remove("disabled"),inputRuns.disabled=!0,btnSetRunsInf.classList.add("enabled")):(btnSetRunsInf.classList.remove("enabled"),inputRuns.disabled=!1,btnSetRunsInf.classList.add("disabled"))}),enableRawData?.addEventListener("click",()=>{enableRawData.checked?rawData.classList.remove("hidden"):rawData.classList.add("hidden")}),btnStartStop?.addEventListener("click",()=>{btnStartStop.classList.contains("disabled")?(stopTest=!0,btnStartStop.classList.remove("disabled"),btnStartStop.classList.add("enabled"),btnStartStop.innerText="Start"):(stopTest=!1,btnStartStop.classList.remove("enabled"),btnStartStop.classList.add("disabled"),btnStartStop.innerText="Stop",startTest())});var stopTest=!1;let storeIQ=new t;async function startTest(){await storeIQ.start(),storeIQ.onError=t=>{console.error(t)};let t=0,e=inputRuns.value,n=btnSetRunsInf.classList.contains("enabled"),a=inputAmount.value,s=[],r={storeIQ:0,storeIQC:0,webStorage:0,indexedDB:0};for(;(e-- >0||n)&&!stopTest;){countRun.innerText=t+++1;let l=await generateData(a),o=await testStoreIQ(l);r.storeIQ+=o.full,r.storeIQC+=o.cached;let i=await testWebStorage(l);r.webStorage+=i;let d=await testIndexedDB(l);if(r.indexedDB+=d,s.push({storeIQ:o,webStorage:i,indexedDB:d}),resultAvgStoreIQ.innerText=`${(r.storeIQC/s.length).toFixed(2)} (${(r.storeIQ/s.length).toFixed(2)})`,resultAvgWebStorage.innerText=(r.webStorage/s.length).toFixed(2),resultAvgIndexedDB.innerText=(r.indexedDB/s.length).toFixed(2),rawDataTable){let u=rawDataTable.insertRow(-1),c=u.insertCell(0),b=u.insertCell(1),S=u.insertCell(2),g=u.insertCell(3);c.innerText=t,b.innerText=`${o.cached.toFixed(2)} (${o.full.toFixed(2)})`,S.innerText=i.toFixed(2),g.innerText=d.toFixed(2)}}}async function testStoreIQ(t){let e=[],n=performance.now();for(let a=0;a<t.length;a++)e.push(storeIQ.setItem(`s_${a}`,t[a]));let s=Promise.all(e),r=performance.now();await s;let l=performance.now();return{full:l-n,cached:r-n}}async function testWebStorage(t){localStorage.clear();let e=performance.now();for(let n=0;n<t.length;n++)localStorage.setItem(`w_${n}`,t[n]);let a=performance.now();return a-e}async function testIndexedDB(t){return new Promise((e,n)=>{let a=indexedDB.open("test",1);a.onupgradeneeded=function(){let t=a.result;t.createObjectStore("data")},a.onsuccess=function(){let n=a.result,s=n.transaction("data","readwrite"),r=s.objectStore("data"),l=performance.now();for(let o=0;o<t.length;o++)r.put(t[o],`i_${o}`);s.oncomplete=function(){let t=performance.now();n.close(),e(t-l);let a=indexedDB.deleteDatabase("test");a.onsuccess=function(){console.log("Deleted database successfully")}}}})}async function renderTimeout(){await new Promise(t=>setTimeout(t,0))}async function generateData(t){await renderTimeout();let e=[];for(let n=0;n<t;n++)e[n]=generateString(1e6/t);return e}function generateString(t){let e=[...Array(t)],n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let a=0;a<t;a++)e[a]=n.charAt(Math.floor(Math.random()*n.length));return e.join("")}