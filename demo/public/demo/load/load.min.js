import t from"../../dist/index.mjs";let inputRuns=document.getElementById("inputRuns"),btnSetRunsInf=document.getElementById("btnSetRunsInf"),inputAmount=document.getElementById("inputAmount"),btnStartStop=document.getElementById("btnStartStop"),enableRawData=document.getElementById("enableRawData"),rawData=document.getElementById("rawData"),rawDataTable=document.getElementById("rawDataTable"),countRun=document.getElementById("countRun"),resultAvgStoreIQ=document.getElementById("resultStorageIQ"),resultAvgWebStorage=document.getElementById("resultWebstorage"),resultAvgIndexedDB=document.getElementById("resultIndexDB");btnSetRunsInf?.addEventListener("click",()=>{btnSetRunsInf.classList.contains("disabled")?(btnSetRunsInf.classList.remove("disabled"),inputRuns.disabled=!0,btnSetRunsInf.classList.add("enabled")):(btnSetRunsInf.classList.remove("enabled"),inputRuns.disabled=!1,btnSetRunsInf.classList.add("disabled"))}),enableRawData?.addEventListener("click",()=>{enableRawData.checked?rawData.classList.remove("hidden"):rawData.classList.add("hidden")}),btnStartStop?.addEventListener("click",()=>{btnStartStop.classList.contains("disabled")?(stopTest=!0,btnStartStop.classList.remove("disabled"),btnStartStop.classList.add("enabled"),btnStartStop.innerText="Start"):(stopTest=!1,btnStartStop.classList.remove("enabled"),btnStartStop.classList.add("disabled"),btnStartStop.innerText="Stop",startTest())});var stopTest=!1;let storeIQ=new t;async function reset(){localStorage.clear(),indexedDB.deleteDatabase("test"),sessionStorage.clear(),await storeIQ.delete()}async function startTest(){await storeIQ.start(),storeIQ.onError=t=>{console.error(t)},await reset();let t=0,e=inputRuns.value,n=btnSetRunsInf.classList.contains("enabled"),a=inputAmount.value,s=[],r={storeIQ:0,webStorage:0,indexedDB:0},l=await generateData(a);{localStorage.clear();let o=[];for(let i=0;i<l.length;i++)o.push(storeIQ.setItem(`s_${i}`,l[i]));await Promise.all(o),await storeIQ.clear();for(let d=0;d<l.length;d++)localStorage.setItem(`w_${d}`,l[d]);await new Promise((t,e)=>{let n=indexedDB.open("test",1);n.onupgradeneeded=function(){let t=n.result;t.createObjectStore("data")},n.onsuccess=function(){let e=n.result,a=e.transaction("data","readwrite"),s=a.objectStore("data");for(let r=0;r<l.length;r++)s.put(l[r],`i_${r}`);a.oncomplete=function(){e.close(),t()}}})}for(;(e-- >0||n)&&!stopTest;){countRun.innerText=t+++1;let u=await testStoreIQ(l);r.storeIQ+=u;let c=await testWebStorage(l);r.webStorage+=c;let b=await testIndexedDB(l);if(r.indexedDB+=b,s.push({storeIQ:u,webStorage:c,indexedDB:b}),resultAvgStoreIQ.innerText=(r.storeIQ/s.length).toFixed(2),resultAvgWebStorage.innerText=(r.webStorage/s.length).toFixed(2),resultAvgIndexedDB.innerText=(r.indexedDB/s.length).toFixed(2),rawDataTable){let S=rawDataTable.insertRow(-1),g=S.insertCell(0),I=S.insertCell(1),w=S.insertCell(2),f=S.insertCell(3);g.innerText=t,I.innerText=u.toFixed(2),w.innerText=c.toFixed(2),f.innerText=b.toFixed(2)}}}async function testStoreIQ(t){let e=[],n=performance.now();for(let a=0;a<t.length;a++)e.push(storeIQ.getItem(`s_${a}`));await Promise.all(e);let s=performance.now();return s-n}async function testWebStorage(t){let e=performance.now();for(let n=0;n<t.length;n++)localStorage.getItem(`w_${n}`);let a=performance.now();return a-e}async function testIndexedDB(t){return new Promise((e,n)=>{let a=indexedDB.open("test",1);a.onupgradeneeded=function(){let t=a.result;t.createObjectStore("data")},a.onsuccess=function(){let n=a.result,s=n.transaction("data","readwrite"),r=s.objectStore("data"),l=performance.now();for(let o=0;o<t.length;o++)r.get(`i_${o}`);s.oncomplete=function(){let t=performance.now();n.close(),e(t-l)}}})}async function generateData(t){let e=[];for(let n=0;n<t;n++)e[n]=generateString(1e6/t);return e}function generateString(t){let e=[...Array(t)],n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let a=0;a<t;a++)e[a]=n.charAt(Math.floor(Math.random()*n.length));return e.join("")}